<?php

function base64UrlEncode($data) {
    return rtrim(strtr(base64_encode($data), '+/', '-_'), '=');
}

function base64UrlDecode($data) {
    return base64_decode(strtr($data, '-_', '+/'));
}

function createJWT($username, $role) {
    $header = json_encode([
        'alg' => 'none',
        'typ' => 'JWT'
    ]);

    $payload = json_encode([
        'username' => $username,
        'role' => $role,
        'exp' => time() + 3600 // 1 jam dari sekarang
    ]);

    $headerEncoded = base64UrlEncode($header);
    $payloadEncoded = base64UrlEncode($payload);

    // Signature dikosongkan sesuai dengan none attack
    $jwt = $headerEncoded . "." . $payloadEncoded . ".";

    return $jwt;
}

function validateJWT($jwt) {
    $parts = explode('.', $jwt);
    if (count($parts) !== 3) return false;

    $header = json_decode(base64UrlDecode($parts[0]), true);
    $payload = json_decode(base64UrlDecode($parts[1]), true);

    if (!$header || !$payload) return false;
    if (!isset($header['alg']) || $header['alg'] !== 'none') return false;
    if (!isset($payload['exp']) || time() > $payload['exp']) return false;

    return $payload;
}
?>
